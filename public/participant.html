<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Articon Hackathon - Participant Portal</title>
    <style>
        * {
            margin: 0;  
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header Styles */
        header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 24px;
            font-weight: bold;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(45deg, #667eea, #764ba2);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        /* Registration Form */
        .registration-form {
            background: white;
            border-radius: 15px;
            padding: 40px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            max-width: 600px;
            margin: 0 auto;
        }

        .form-title {
            font-size: 28px;
            margin-bottom: 30px;
            text-align: center;
            color: #333;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #555;
        }

        input, select, textarea {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .category-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 10px;
        }

        .category-card {
            padding: 20px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .category-card:hover {
            border-color: #667eea;
            transform: translateY(-2px);
        }

        .category-card.selected {
            border-color: #667eea;
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
        }

        .category-icon {
            font-size: 32px;
            margin-bottom: 10px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            width: 100%;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        }

        .btn-secondary {
            background: #f8f9fa;
            color: #333;
            border: 2px solid #e1e5e9;
        }

        .btn-secondary:hover {
            background: #e9ecef;
        }

        /* Dashboard Styles */
        .dashboard {
            display: none;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .dashboard-card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .card-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 15px;
            color: #333;
        }

        .card-value {
            font-size: 36px;
            font-weight: bold;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* Tasks Section */
        .tasks-section {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        .section-title {
            font-size: 24px;
            font-weight: 600;
            color: #333;
        }

        .task-grid {
            display: grid;
            gap: 20px;
        }

        .task-card {
            border: 2px solid #e1e5e9;
            border-radius: 12px;
            padding: 25px;
            transition: all 0.3s ease;
        }

        .task-card:hover {
            border-color: #667eea;
            transform: translateY(-2px);
        }

        .task-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 15px;
        }

        .task-title {
            font-size: 18px;
            font-weight: 600;
            color: #333;
            flex: 1;
        }

        .task-category {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .category-video {
            background: #e3f2fd;
            color: #1976d2;
        }

        .category-ui_ux {
            background: #f3e5f5;
            color: #7b1fa2;
        }

        .category-graphics {
            background: #e8f5e8;
            color: #388e3c;
        }

        .task-description {
            color: #666;
            line-height: 1.6;
            margin-bottom: 20px;
        }

        .task-actions {
            display: flex;
            gap: 10px;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: white;
            margin: 5% auto;
            padding: 40px;
            border-radius: 15px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .modal-title {
            font-size: 24px;
            font-weight: 600;
            color: #333;
        }

        .close {
            font-size: 28px;
            font-weight: bold;
            color: #aaa;
            cursor: pointer;
        }

        .close:hover {
            color: #000;
        }

        .file-upload-area {
            border: 2px dashed #667eea;
            border-radius: 8px;
            padding: 40px;
            text-align: center;
            margin: 20px 0;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .file-upload-area:hover {
            background: #f8f9ff;
            border-color: #764ba2;
        }

        .file-upload-area.dragover {
            background: #f8f9ff;
            border-color: #764ba2;
        }

        .upload-icon {
            font-size: 48px;
            color: #667eea;
            margin-bottom: 15px;
        }

        .file-input {
            display: none;
        }

        .file-info {
            margin-top: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        /* Loading Spinner */
        .spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Alert Styles */
        .alert {
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid;
        }

        .alert-success {
            background: #d4edda;
            border-color: #28a745;
            color: #155724;
        }

        .alert-error {
            background: #f8d7da;
            border-color: #dc3545;
            color: #721c24;
        }

        .alert-info {
            background: #d1ecf1;
            border-color: #17a2b8;
            color: #0c5460;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            .header-content {
                flex-direction: column;
                gap: 15px;
            }

            .registration-form {
                padding: 20px;
            }

            .modal-content {
                margin: 10% auto;
                padding: 20px;
                width: 95%;
            }

            .dashboard-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header id="header">
            <div class="header-content">
                <div class="logo">üé® Articon Hackathon 2024</div>
                <div class="user-info" id="userInfo" style="display: none;">
                    <div class="user-avatar" id="userAvatar">JD</div>
                    <div>
                        <div id="userName">John Doe</div>
                        <div id="userCategory" style="font-size: 12px; color: #666;">Video</div>
                    </div>
                    <button class="btn btn-secondary" onclick="logout()">Logout</button>
                </div>
            </div>
        </header>

        <!-- Registration Form -->
        <div id="registrationSection" class="registration-form">
            <h2 class="form-title">Participant Registration</h2>
            <form id="registrationForm">
                <div id="alertContainer"></div>

                <div class="form-group">
                    <label for="name">Full Name *</label>
                    <input type="text" id="name" name="name" required>
                </div>

                <div class="form-group">
                    <label for="email">Email Address *</label>
                    <input type="email" id="email" name="email" required>
                </div>

                <div class="form-group">
                    <label for="whatsapp">WhatsApp Number *</label>
                    <input type="tel" id="whatsapp" name="whatsapp" placeholder="+1234567890" required>
                </div>

                <div class="form-group">
                    <label>Select Category *</label>
                    <div class="category-grid">
                        <div class="category-card" data-category="video" onclick="selectCategory('video')">
                            <div class="category-icon">üé¨</div>
                            <div>Video</div>
                        </div>
                        <div class="category-card" data-category="ui_ux" onclick="selectCategory('ui_ux')">
                            <div class="category-icon">üé®</div>
                            <div>UI/UX</div>
                        </div>
                        <div class="category-card" data-category="graphics" onclick="selectCategory('graphics')">
                            <div class="category-icon">üñºÔ∏è</div>
                            <div>Graphics</div>
                        </div>
                    </div>
                    <input type="hidden" id="category" name="category" required>
                </div>

                <div class="form-group">
                    <label for="city">City *</label>
                    <input type="text" id="city" name="city" required>
                </div>

                <div class="form-group">
                    <label for="portfolio">Portfolio URL</label>
                    <input type="url" id="portfolio" name="portfolio" placeholder="https://your-portfolio.com">
                </div>

                <button type="submit" class="btn btn-primary" id="registerBtn">
                    Register for Hackathon
                </button>
            </form>
        </div>

        <!-- Dashboard -->
        <div id="dashboardSection" class="dashboard">
            <!-- Dashboard Stats -->
            <div class="dashboard-grid">
                <div class="dashboard-card">
                    <div class="card-title">Your Category</div>
                    <div class="card-value" id="dashboardCategory">-</div>
                </div>
                <div class="dashboard-card">
                    <div class="card-title">Tasks Available</div>
                    <div class="card-value" id="tasksCount">-</div>
                </div>
                <div class="dashboard-card">
                    <div class="card-title">Submissions</div>
                    <div class="card-value" id="submissionsCount">-</div>
                </div>
            </div>

            <!-- Tasks Section -->
            <div class="tasks-section">
                <div class="section-header">
                    <h2 class="section-title">Your Tasks</h2>
                    <button class="btn btn-secondary" onclick="refreshTasks()">
                        üîÑ Refresh
                    </button>
                </div>
                <div id="tasksList" class="task-grid">
                    <!-- Tasks will be loaded here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Submission Modal -->
    <div id="submissionModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Submit Your Work</h2>
                <span class="close" onclick="closeSubmissionModal()">&times;</span>
            </div>

            <div id="modalAlertContainer"></div>

            <div id="taskInfo" style="margin-bottom: 20px;">
                <!-- Task info will be displayed here -->
            </div>

            <form id="submissionForm">
                <div class="form-group">
                    <label>Upload Your File *</label>
                    <div class="file-upload-area" id="fileUploadArea" onclick="document.getElementById('fileInput').click()">
                        <div class="upload-icon">üìÅ</div>
                        <div>Click to upload or drag and drop</div>
                        <div style="font-size: 14px; color: #666; margin-top: 10px;">
                            Supported formats: Images (JPEG, PNG, GIF, WebP, SVG),
                            Videos (MP4, MOV, AVI, MKV, WebM),
                            Graphics (PDF, AI, PSD) - Max 100MB
                        </div>
                    </div>
                    <input type="file" id="fileInput" class="file-input" accept="image/*,video/*,.pdf,.ai,.psd" onchange="handleFileSelect(event)">
                    <div id="fileInfo" class="file-info" style="display: none;">
                        <div id="fileName"></div>
                        <div id="fileSize"></div>
                    </div>
                </div>

                <button type="submit" class="btn btn-primary" id="submitBtn">
                    Submit Work
                </button>
            </form>
        </div>
    </div>

    <script>
        // Global variables
        let currentUser = null;
        let selectedTask = null;
        let selectedFile = null;

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            checkAuth();
            setupEventListeners();
        });

        // Check if user is already logged in
        function checkAuth() {
            const userData = localStorage.getItem('hackathonUser');
            if (userData) {
                currentUser = JSON.parse(userData);
                showDashboard();
            } else {
                showRegistration();
            }
        }

        // Setup event listeners
        function setupEventListeners() {
            // Registration form
            document.getElementById('registrationForm').addEventListener('submit', handleRegistration);

            // Submission form
            document.getElementById('submissionForm').addEventListener('submit', handleSubmission);

            // File upload drag and drop
            const uploadArea = document.getElementById('fileUploadArea');
            uploadArea.addEventListener('dragover', handleDragOver);
            uploadArea.addEventListener('dragleave', handleDragLeave);
            uploadArea.addEventListener('drop', handleFileDrop);
        }

        // Category selection
        function selectCategory(category) {
            // Remove previous selection
            document.querySelectorAll('.category-card').forEach(card => {
                card.classList.remove('selected');
            });

            // Add selection to clicked category
            document.querySelector(`[data-category="${category}"]`).classList.add('selected');
            document.getElementById('category').value = category;
        }

        // Handle registration
        async function handleRegistration(e) {
            e.preventDefault();

            const formData = new FormData(e.target);
            const data = {
                name: formData.get('name'),
                email: formData.get('email'),
                whatsapp_no: formData.get('whatsapp'),
                category: formData.get('category'),
                city: formData.get('city'),
                portfolio_url: formData.get('portfolio') || ''
            };

            if (!data.category) {
                showAlert('Please select a category', 'error');
                return;
            }

            const submitBtn = document.getElementById('registerBtn');
            submitBtn.innerHTML = '<span class="spinner"></span> Registering...';
            submitBtn.disabled = true;

            try {
                const response = await fetch('/api/participants/register', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });

                const result = await response.json();

                if (result.success) {
                    currentUser = result.data.participant;
                    localStorage.setItem('hackathonUser', JSON.stringify(currentUser));
                    showAlert('Registration successful! Redirecting to dashboard...', 'success');
                    setTimeout(() => showDashboard(), 1500);
                } else {
                    showAlert(result.message || 'Registration failed', 'error');
                }
            } catch (error) {
                showAlert('Network error. Please try again.', 'error');
            } finally {
                submitBtn.innerHTML = 'Register for Hackathon';
                submitBtn.disabled = false;
            }
        }

        // Show dashboard
        function showDashboard() {
            document.getElementById('registrationSection').style.display = 'none';
            document.getElementById('dashboardSection').style.display = 'block';

            // Update header
            document.getElementById('userInfo').style.display = 'flex';
            document.getElementById('userName').textContent = currentUser.name;
            document.getElementById('userCategory').textContent = currentUser.category.replace('_', '/');
            document.getElementById('userAvatar').textContent = currentUser.name.split(' ').map(n => n[0]).join('').toUpperCase();

            // Update dashboard stats
            document.getElementById('dashboardCategory').textContent = currentUser.category.replace('_', '/');

            // Load tasks and submissions
            loadTasks();
            loadSubmissions();
        }

        // Show registration form
        function showRegistration() {
            document.getElementById('registrationSection').style.display = 'block';
            document.getElementById('dashboardSection').style.display = 'none';
            document.getElementById('userInfo').style.display = 'none';
        }

        // Load tasks for current user's category
        async function loadTasks() {
            try {
                const response = await fetch(`/api/participants/${currentUser.id}/tasks`);
                const result = await response.json();

                if (result.success) {
                    const tasks = result.data;
                    document.getElementById('tasksCount').textContent = tasks.length;
                    displayTasks(tasks);
                } else {
                    showAlert('Failed to load tasks', 'error');
                }
            } catch (error) {
                showAlert('Network error while loading tasks', 'error');
            }
        }

        // Display tasks
        function displayTasks(tasks) {
            const tasksList = document.getElementById('tasksList');

            if (tasks.length === 0) {
                tasksList.innerHTML = '<div style="text-align: center; padding: 40px; color: #666;">No tasks available for your category yet.</div>';
                return;
            }

            tasksList.innerHTML = tasks.map(task => `
                <div class="task-card">
                    <div class="task-header">
                        <div class="task-title">${task.title}</div>
                        <span class="task-category category-${task.category}">${task.category.replace('_', '/')}</span>
                    </div>
                    <div class="task-description">${task.description}</div>
                    <div class="task-actions">
                        <button class="btn btn-primary" onclick="openSubmissionModal('${task.id}', '${task.title.replace(/'/g, "\\'")}', '${task.description.replace(/'/g, "\\'")}')">
                            Submit Work
                        </button>
                    </div>
                </div>
            `).join('');
        }

        // Load submissions
        async function loadSubmissions() {
            try {
                const response = await fetch(`/api/submissions/participant/${currentUser.id}`);
                const result = await response.json();

                if (result.success) {
                    document.getElementById('submissionsCount').textContent = result.data.length;
                }
            } catch (error) {
                console.error('Error loading submissions:', error);
            }
        }

        // Open submission modal
        function openSubmissionModal(taskId, taskTitle, taskDescription) {
            selectedTask = { id: taskId, title: taskTitle, description: taskDescription };

            document.getElementById('taskInfo').innerHTML = `
                <h3>${taskTitle}</h3>
                <p style="color: #666; margin-top: 10px;">${taskDescription}</p>
            `;

            document.getElementById('submissionModal').style.display = 'block';
        }

        // Close submission modal
        function closeSubmissionModal() {
            document.getElementById('submissionModal').style.display = 'none';
            document.getElementById('submissionForm').reset();
            document.getElementById('fileInfo').style.display = 'none';
            selectedFile = null;
            selectedTask = null;
        }

        // Handle file selection
        function handleFileSelect(event) {
            const file = event.target.files[0];
            if (file) {
                processFile(file);
            }
        }

        // Handle drag and drop
        function handleDragOver(event) {
            event.preventDefault();
            event.currentTarget.classList.add('dragover');
        }

        function handleDragLeave(event) {
            event.currentTarget.classList.remove('dragover');
        }

        function handleFileDrop(event) {
            event.preventDefault();
            event.currentTarget.classList.remove('dragover');

            const files = event.dataTransfer.files;
            if (files.length > 0) {
                processFile(files[0]);
            }
        }

        // Process selected file
        function processFile(file) {
            // Validate file size (100MB)
            if (file.size > 100 * 1024 * 1024) {
                showAlert('File size exceeds 100MB limit', 'error');
                return;
            }

            selectedFile = file;

            // Display file info
            document.getElementById('fileName').textContent = `File: ${file.name}`;
            document.getElementById('fileSize').textContent = `Size: ${(file.size / 1024 / 1024).toFixed(2)} MB`;
            document.getElementById('fileInfo').style.display = 'block';
        }

        // Handle submission
        async function handleSubmission(e) {
            e.preventDefault();

            if (!selectedFile) {
                showAlert('Please select a file to submit', 'error');
                return;
            }

            if (!selectedTask) {
                showAlert('No task selected', 'error');
                return;
            }

            const submitBtn = document.getElementById('submitBtn');
            submitBtn.innerHTML = '<span class="spinner"></span> Submitting...';
            submitBtn.disabled = true;

            try {
                const formData = new FormData();
                formData.append('file', selectedFile);
                formData.append('participant_id', currentUser.id);
                formData.append('task_id', selectedTask.id);

                const response = await fetch('/api/upload/submit', {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();

                if (result.success) {
                    showAlert('Work submitted successfully!', 'success');
                    closeSubmissionModal();
                    loadSubmissions(); // Refresh submissions count
                    // Optionally refresh tasks to show submission status
                    loadTasks();
                } else {
                    showAlert(result.message || 'Submission failed', 'error');
                }
            } catch (error) {
                showAlert('Network error. Please try again.', 'error');
            } finally {
                submitBtn.innerHTML = 'Submit Work';
                submitBtn.disabled = false;
            }
        }

        // Refresh tasks
        function refreshTasks() {
            loadTasks();
        }

        // Logout
        function logout() {
            localStorage.removeItem('hackathonUser');
            currentUser = null;
            showRegistration();
            // Clear form
            document.getElementById('registrationForm').reset();
            document.querySelectorAll('.category-card').forEach(card => {
                card.classList.remove('selected');
            });
        }

        // Show alert
        function showAlert(message, type) {
            const alertContainer = document.getElementById('alertContainer');
            const alertHtml = `
                <div class="alert alert-${type}">
                    ${message}
                </div>
            `;
            alertContainer.innerHTML = alertHtml;

            // Auto dismiss after 5 seconds
            setTimeout(() => {
                alertContainer.innerHTML = '';
            }, 5000);
        }

        // Show modal alert
        function showModalAlert(message, type) {
            const alertContainer = document.getElementById('modalAlertContainer');
            const alertHtml = `
                <div class="alert alert-${type}">
                    ${message}
                </div>
            `;
            alertContainer.innerHTML = alertHtml;

            // Auto dismiss after 5 seconds
            setTimeout(() => {
                alertContainer.innerHTML = '';
            }, 5000);
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('submissionModal');
            if (event.target === modal) {
                closeSubmissionModal();
            }
        }
    </script>
</body>
</html>
